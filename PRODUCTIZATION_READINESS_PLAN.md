# План модернизации до «продажного» состояния

## Контекст
Текущая версия приложения содержит несколько решений, заточенных под конкретный производственный контур (локальные названия папок, бренд-специфичные интеграции, русскоязычные/эмодзи-статусы и фиксированные сценарии автопотока). Для выхода на массового пользователя нужно отделить:
1) **ядро продукта** (универсальная логика),
2) **интеграционные адаптеры** (PitStop/Imposing/архив),
3) **профиль клиента** (пути, термины, workflow-политики).

---

## 1) Что сейчас «кастомно под одного заказчика»

### 1.1 Жёстко заданные пути и термины
- Значения по умолчанию в настройках:
  - `OrdersRootPath = C:\Андрей ПК`
  - `GrandpaPath = \\NAS\work\Temp\!!!Дедушка`
- В интерфейсе и логике используются пользовательские термины: «Дедушка», «Готово», «В архиве».

### 1.2 Логика статусов завязана на конкретную файловую структуру
- Статус «В архиве» вычисляется на основании факта наличия файла в подпапке `Дедушка\Готово`.
- Статус «Готово» может ставиться по наличию печатного файла в другом месте.

### 1.3 Доменные/вендорные интеграции зашиты в основной поток
- Базовый процессор напрямую знает про PitStop/Hotfolder/Imposing.
- В UI и сообщениях эти термины отражены как часть «основного» функционала, а не как опциональные плагины.

### 1.4 Локализация и текстовые константы
- Строки интерфейса, ошибок и статусов смешаны (русский/английский), часть с эмодзи.
- Нет централизованного словаря терминов/языков.

### 1.5 Логи и диагностика
- Есть общий лог и по-заказные логи, но нет формального уровня телеметрии продукта (диагностические события, анонимизированные метрики, экспорт инцидента).

---

## 2) Риски для массового рынка

1. **Сложность внедрения**: пользователю нужно «угадать» папочную модель и терминологию.
2. **Высокая стоимость поддержки**: много кейсов «почему статус не тот», привязка к конкретной инфраструктуре.
3. **Слабая переносимость**: другой NAS/другая файловая политика/другой DTP-стек ломают сценарии.
4. **Сложность интернационализации**: продукт не готов к EN/мультиязычному рынку.
5. **Регрессы в статусах**: бизнес-правила хранятся как распределённые string-based проверки.

---

## 3) Целевой образ продукта (Target)

## 3.1 Продуктовое ядро
- Универсальная модель заказа + state machine статусов.
- Статусы не зависят от названий клиентских папок.
- Чёткое разделение:
  - `BusinessStatus` (Waiting/InProgress/Done/Error/Archived)
  - `OperationalStage` (Scanning, PitStopCopy, ImposingWait...)

## 3.2 Профиль клиента (Tenant/Workspace Profile)
- Все пути, названия папок, правила архивации, язык UI, и словарь терминов — в профиле.
- Быстрый мастер первичной настройки для нового клиента.

## 3.3 Интеграционные адаптеры
- PitStop/Imposing и прочие интеграции подключаются как опции.
- При отсутствии интеграции ядро продолжает работать в «ручном» или «базовом» режиме.

## 3.4 Диагностика продукта
- Единый журнал событий (event log) + фильтр по заказу.
- Экспорт «пакета диагностики» для поддержки.

---

## 4) Пошаговый план модернизации

## Этап A — «Стабилизация и декомпозиция» (короткий)
1. Централизовать все пользовательские строки/термины в ресурсах.
2. Ввести конфиг-параметры для:
   - корня хранения,
   - правил архивации,
   - названий «публичных» папок/ярлыков.
3. Задокументировать контракт статусов и источники переходов.

**Результат:** снимаем критичную «жёсткую прошивку» под одного пользователя.

## Этап B — «Конфигурируемый workflow»
1. Вынести правила статусов в policy-компонент (`IStatusPolicy`).
2. Вынести правила архивации в policy-компонент (`IArchivePolicy`):
   - где считается `Done`,
   - где считается `Archived`.
3. Добавить мастер настройки профиля (UI):
   - выбор папок,
   - тест доступности,
   - проверка прав записи,
   - пробный прогон.

**Результат:** продукт можно развернуть у разных клиентов без переписывания кода.

## Этап C — «Плагинизация интеграций»
1. Интерфейс адаптера обработки (`IProcessingAdapter`).
2. Реализации: `PitStopAdapter`, `ImposingAdapter`, `FileOnlyAdapter`.
3. UI выбора адаптера и диагностики подключения.

**Результат:** PitStop/Imposing становится опциональной надстройкой.

## Этап D — «Продукт и продажи»
1. Онбординг/мастер первого запуска.
2. Профили шаблонов для сегментов (типография, рекламка, in-house).
3. Документация пользователя + админа + FAQ «статусы/ошибки».
4. Версионирование конфигов и миграции.

**Результат:** повторяемый сценарий внедрения и поддержки.

---

## 5) Минимальный scope на ближайший релиз (MVP productization)
1. Убрать бренд-специфичные имена из дефолтов (нейтральные `WorkRoot`, `ArchiveRoot`, `ArchiveDoneSubfolder`).
2. Вынести «Дедушка/Готово» в настраиваемые алиасы отображения.
3. Добавить экран «Профиль клиента» в Settings.
4. Сделать проверку конфигурации кнопкой «Проверить окружение».
5. Добавить «диагностический отчёт по заказу» (краткая сводка из логов) в UI.

---

## 6) Критерии готовности к продажам (Definition of Done)
- Приложение запускается «с нуля» без ручного редактирования файлов.
- Пользователь может сконфигурировать рабочие папки через UI.
- Термины и язык UI переключаемы (минимум RU/EN).
- Интеграции можно отключать/включать без изменения кода.
- Есть понятная диагностика статусов и ошибок по каждому заказу.
- Есть базовая документация внедрения и поддержки.

---

## 7) Уточняющие вопросы

### По продуктовой упаковке
1. Целевой сегмент №1: типографии, агентства или универсальный SMB?
2. Нужна ли cloud-версия в будущем, или только desktop/on-premise?
3. Планируется ли коммерческое лицензирование (подписка/разовая/по рабочим местам)?

### По UX/терминам
4. Оставляем ли пользовательские «человеческие» названия папок (типа «Дедушка») только как alias в UI?
5. Нужна ли мультиязычность уже в ближайшем релизе (RU+EN)?
6. Эмодзи в статусах оставляем как опцию или убираем по умолчанию?

### По workflow
7. Может ли у клиента не быть PitStop/Imposing вообще (только ручной режим)?
8. Нужен ли режим «песочницы» (dry-run), чтобы проверять цепочку без реального копирования?
9. Требуется ли сценарный редактор (визуальный конструктор шагов) или достаточно профилей?

### По поддержке и диагностике
10. Должен ли оператор отправлять «пакет диагностики» в 1 клик (логи + конфиг + версия)?
11. Нужен ли внутренний «health-check» сетевых папок и прав доступа по расписанию?
12. Нужна ли роль «администратор/оператор» с разграничением действий?

### По релиз-процессу
13. Нужен ли автоапдейтер приложения?
14. Нужен ли офлайн-установщик с проверкой зависимостей?
15. Какие 3 метрики важнее для старта продаж: время внедрения, количество ошибок статусов, среднее время обработки заказа?

---

## 8) Рекомендуемый следующий шаг
Согласовать ответы на вопросы из раздела 7 и зафиксировать **Product Profile v1** (минимум: целевой сегмент, словарь терминов, обязательные/опциональные интеграции, модель лицензирования). После этого можно разложить roadmap на 2–3 итерации с точными задачами по коду.
